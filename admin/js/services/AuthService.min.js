app.factory("AuthService",["$http","Session","$state",function(c,b,a){return{loaded:false,login:function(f,g,e){var d=this;c({method:"POST",url:"http://localhost:9090/users/login",data:f,withCredentials:true}).then(function(h){if(h.data.success){var i=h.data.auth;d.createSession(i)}g(h.data.auth.user)},e)},isAuthorized:function(d){if(d.indexOf("public")!==-1||d.indexOf(b.role)!==-1){return true}return false},createSession:function(d){b.create(d.sessionId,d.user._id,d.user.role,d.accessToken)},logout:function(){b.destroy();c({method:"GET",url:"http://localhost:9090/users/logout",withCredentials:true}).then(function(d){if(d.data.success){console.log("User session destroyed")}});a.go("login")},isLogged:function(){return b.userId!==null},loadSession:function(e){e=e===undefined?function(){}:e;var d=this;c({method:"GET",url:"http://localhost:9090/users/load-session",withCredentials:true}).then(function(f){if(f.data.success){d.createSession(f.data.auth);e(true)}else{e(false)}d.loaded=true},function(){d.loaded=true;e(false)})}}}]);