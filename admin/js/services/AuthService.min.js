app.factory("AuthService",["$rootScope","$http","Session","$state","SERVERS",function(a,e,c,b,d){return{loaded:false,login:function(h,i,g){var f=this;e({method:"POST",url:d.builder+"users/login",data:h,withCredentials:true}).then(function(j){if(j.data.success){var k=j.data.auth;f.createSession(k);a.setCurrentUser(k.user)}else{g()}},g)},isAuthorized:function(){var g=[];for(var f=0;f<arguments.length;f++){g=g.concat(arguments[f])}if(g.indexOf("public")!==-1||g.indexOf(c.role)!==-1){return true}return true},createSession:function(f){c.create(f.sessionId,f.user._id,f.user.role,f.accessToken)},logout:function(){c.destroy();a.setCurrentUser(null);e({method:"GET",url:d.builder+"users/logout",withCredentials:true}).then(function(f){if(f.data.success){console.log("User session destroyed")}});b.go("login")},isLogged:function(){return c.userId!==null},loadSession:function(g){g=g===undefined?function(){}:g;var f=this;e({method:"GET",url:d.builder+"users/load-session",withCredentials:true}).then(function(h){if(h.data.success){var i=h.data.auth;f.createSession(i);a.setCurrentUser(i.user);g(true)}else{g(false)}f.loaded=true},function(){f.loaded=true;g(false)})}}}]);