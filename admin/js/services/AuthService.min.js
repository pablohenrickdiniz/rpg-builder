app.factory("AuthService",["$rootScope","$http","Session","$state",function(a,d,c,b){return{loaded:false,login:function(g,h,f){var e=this;d({method:"POST",url:"http://localhost:9090/users/login",data:g,withCredentials:true}).then(function(i){if(i.data.success){var j=i.data.auth;e.createSession(j);a.setCurrentUser(j.user)}else{f()}},f)},isAuthorized:function(){var f=[];for(var e=0;e<arguments.length;e++){f=f.concat(arguments[e])}if(f.indexOf("public")!==-1||f.indexOf(c.role)!==-1){return true}return false},createSession:function(e){c.create(e.sessionId,e.user._id,e.user.role,e.accessToken)},logout:function(){c.destroy();a.setCurrentUser(null);d({method:"GET",url:"http://localhost:9090/users/logout",withCredentials:true}).then(function(e){if(e.data.success){console.log("User session destroyed")}});b.go("login")},isLogged:function(){return c.userId!==null},loadSession:function(f){f=f===undefined?function(){}:f;var e=this;d({method:"GET",url:"http://localhost:9090/users/load-session",withCredentials:true}).then(function(g){if(g.data.success){var h=g.data.auth;e.createSession(h);a.setCurrentUser(h.user);f(true)}else{f(false)}e.loaded=true},function(){e.loaded=true;f(false)})}}}]);