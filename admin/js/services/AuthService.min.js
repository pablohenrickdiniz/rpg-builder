app.factory("AuthService",["$rootScope","$http","Session","$state","URLS",function(b,e,d,c,a){return{loaded:false,login:function(h,i,g){var f=this;e({method:"POST",url:a.BASE_URL+"users/login",data:h,withCredentials:true}).then(function(j){if(j.data.success){var k=j.data.auth;f.createSession(k);b.setCurrentUser(k.user)}else{g()}},g)},isAuthorized:function(){var g=[];for(var f=0;f<arguments.length;f++){g=g.concat(arguments[f])}if(g.indexOf("public")!==-1||g.indexOf(d.role)!==-1){return true}return true},createSession:function(f){d.create(f.sessionId,f.user._id,f.user.role,f.accessToken)},logout:function(){d.destroy();b.setCurrentUser(null);e({method:"GET",url:a.BASE_URL+"users/logout",withCredentials:true}).then(function(f){if(f.data.success){console.log("User session destroyed")}});c.go("login")},isLogged:function(){return d.userId!==null},loadSession:function(g){g=g===undefined?function(){}:g;var f=this;e({method:"GET",url:a.BASE_URL+"users/load-session",withCredentials:true}).then(function(h){if(h.data.success){var i=h.data.auth;f.createSession(i);b.setCurrentUser(i.user);g(true)}else{g(false)}f.loaded=true},function(){f.loaded=true;g(false)})}}}]);